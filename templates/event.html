
{% extends "base.html" %}
    {% load static %}

        {% block content %}
        

         {% block event_is_active %}active{% endblock event_is_active %}

        <!-- Events Start -->
         
        <div class="container-fluid event py-5">
            <div class="container py-5">
                <h1 class="display-3 mb-5 wow fadeIn" data-wow-delay="0.1s">Événements <span class="text-primary">À Venir</span></h1>

                {% if is_association %}
                <div class="text-center mb-4">
                    <a href="{% url 'events:create_event' %}" class="btn btn-primary rounded-pill px-4 py-2">
                        <i class="fa fa-plus me-2"></i>Créer un événement
                    </a>
                </div>
                {% endif %}

                <!-- Search + filters using EventSearchForm -->
                <div class="row justify-content-center mb-4">
                    <div class="col-lg-8 col-md-12">
                        <form method="get" action="{% url 'events:search' %}" class="row g-2 align-items-center">
                            <div class="col-md-4">
                                {{ form.association }}
                            </div>
                            <div class="col-md-4">
                                {{ form.keywords }}
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-primary rounded-pill px-4" type="submit">
                                    <i style="font-size:16px" class="fa fa-search me-2"></i>Filtrer
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                {% if search_events %}
                    {% for event in search_events %}
                        <div class="row g-4 event-item wow fadeIn" data-wow-delay="0.{{ forloop.counter }}s">
                            <div class="col-3 col-lg-2 pe-0">
                                <div class="text-center border-bottom border-dark py-3 px-2">
                                    <h6>Début : {{ event.start_at|date:"d M Y" }}</h6>
                                    <p class="mb-0">Fin : {{ event.finish_at|date:"d M Y" }}</p>
                                </div>
                            </div>
                            <div class="col-9 col-lg-6 border-start border-dark pb-5">
                                <div class="ms-3">
                                    <a href="{% url 'events:Details_event' event.id %}" class="text-decoration-none text-dark">
                                        <h4 class="mb-1">{{ event.title|truncatechars:40 }}</h4>
                                    </a>
                                    <p class="mb-2 text-muted" style="font-size: 0.9rem;">
                                        <i class="fas fa-building me-1"></i>
                                        {{ event.association.name }}
                                    </p>
                                    <p class="mb-3">{{ event.description }}</p>
                                     <div class="mb-2 d-flex flex-wrap align-items-center gap-2">
                                         <span class="badge bg-primary badge-participants px-3 py-2 me-2" style="font-size: 0.95rem;">
                                            <i class="fa fa-users me-1"></i>
                                            Participants prévus : {{ event.n_participants }}
                                        </span>
                                        <span class="badge px-3 py-2" style="font-size: 0.9rem; background-color: #87CEEB; color: #003366;">
                                            Statut : {{ event.get_status_display }}
                                        </span>
                                    </div>
                                    {% if is_normal_user and event.status != "cancelled" %}
                                    <div class="mt-2">
                                        {% if event.user_joined %}
                                            <a href="{% url 'events:cancel_event' event.id %}" class="btn btn-sm rounded-pill btn-annuler">
                                                Annuler
                                            </a>
                                        {% else %}
                                            <a href="{% url 'events:join_event' event.id %}" class="btn btn-sm rounded-pill btn-participer">
                                                Participer
                                            </a>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-12 col-lg-4">
                                <div class="overflow-hidden mb-5">
                                    {% if event.image %}
                                        <img src="{{ event.image.url }}" class="img-fluid w-100" alt="{{ event.title }}">
                                    {% else %}
                                        <img src="{% static 'img/test.jpg' %}" class="img-fluid w-100" alt="{{ event.title }}">
                                    {% endif %}
                                </div>
                            </div>
                        </div>  
                    {% empty %}
                        <div class="col-12 text-center">
                            <p class="text-muted mb-0">Aucune annonce pour le moment.</p>
                        </div>                  
                    {% endfor %}
                {% else %}
                    {% for event in events %}
                    <div class="row g-4 event-item wow fadeIn" data-wow-delay="0.{{ forloop.counter }}s">
                        <div class="col-3 col-lg-2 pe-0">
                            <div class="text-center border-bottom border-dark py-3 px-2">
                                <h6>Début : {{ event.start_at|date:"d M Y" }}</h6>
                                <p class="mb-0">Fin : {{ event.finish_at|date:"d M Y" }}</p>
                            </div>
                        </div>
                        <div class="col-9 col-lg-6 border-start border-dark pb-5">
                            <div class="ms-3">
                                <a href="{% url 'events:Details_event' event.id %}" class="text-decoration-none text-dark">
                                    <h4 class="mb-1">{{ event.title }}</h4>
                                </a>
                                <p class="mb-2 text-muted" style="font-size: 0.9rem;">
                                    <i class="fas fa-building me-1"></i>
                                    {{ event.association.name }}
                                </p>
                                <p class="mb-3">{{ event.description }}</p>
                                    <div class="mb-2 d-flex flex-wrap align-items-center gap-2">
                                        <span class="badge bg-primary badge-participants px-3 py-2 me-2" style="font-size: 0.95rem;">
                                        <i class="fa fa-users me-1"></i>
                                        Participants prévus : {{ event.n_participants }}
                                    </span>
                                    <span class="badge px-3 py-2" style="font-size: 0.9rem; background-color: #87CEEB; color: #003366;">
                                        Statut : {{ event.get_status_display }}
                                    </span>
                                </div>
                                {% if is_normal_user and event.status != "cancelled" %}
                                <div class="mt-2">
                                    {% if event.user_joined %}
                                        <a href="{% url 'events:cancel_event' event.id %}" class="btn btn-sm rounded-pill btn-annuler">
                                            Annuler
                                        </a>
                                    {% else %}
                                        <a href="{% url 'events:join_event' event.id %}" class="btn btn-sm rounded-pill btn-participer">
                                            Participer
                                        </a>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-12 col-lg-4">
                            <div class="overflow-hidden mb-5">
                                {% if event.image %}
                                    <img src="{{ event.image.url }}" class="img-fluid w-100" alt="{{ event.title }}">
                                {% else %}
                                    <img src="{% static 'img/test.jpg' %}" class="img-fluid w-100" alt="{{ event.title }}">
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-muted">Aucun évènement pour le moment.</p>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
        <!-- Events End -->

        {% endblock %}


        