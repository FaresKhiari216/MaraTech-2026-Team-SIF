{% extends "base.html" %}

{% load static %}

        {% block content %}

        {% block announcement_is_active %}active{% endblock announcement_is_active %}
        <!-- Sermon Start -->
        <div class="container-fluid sermon py-5">
            <div class="container py-5">
                <div class="text-center mx-auto mb-5 wow fadeIn" data-wow-delay="0.1s" style="max-width: 700px;">
                    <p class="fs-5 text-uppercase text-primary">Cas sociaux</p>
                    <h1 style ="font-size: 2.75rem;" class="display-3">Trouver quelqu'un dans le besoin</h1>
                </div>
                
                {% if is_association %}
                <div class="text-center mb-4">

                    <a href="{% url 'announcements:create' %}" class="btn btn-primary rounded-pill px-4 py-2">
                        <i class="fa fa-plus me-2"></i>Cr√©er une annonce
                    </a>
                    
                </div>
                {% endif %}
                <!-- Search + filters using AnnouncementSearchForm -->
                <div class="row justify-content-center mb-4">
                    <div class="col-lg-8 col-md-10">
                        <form method="get" action="{% url 'announcements:search' %}" class="row g-2 align-items-center">
                            <div class="col-md-4">
                                {{ form.category }}
                            </div>
                            <div class="col-md-5">
                                {{ form.keywords }}
                            </div>
                            <div class="col-md-3 d-flex align-items-center gap-2 justify-content-end">
                                <div class="form-check mb-0">
                                    {{ form.emergency }}
                                    <label class="form-check-label" for="{{ form.emergency.id_for_label }}">Urgent</label>
                                </div>
                                <button class="btn btn-primary rounded-pill px-4" type="submit">
                                    <i style="font-size:16px" class="fa fa-search me-2"></i>Filtrer
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="row g-4 justify-content-center">
                    {% if results_search %}
                        {% for announcement in results_search %}
                        <div class="col-lg-6 col-xl-4">
                            <div class="sermon-item wow fadeIn" data-wow-delay="0.{{ forloop.counter }}s">
                                <div class="overflow-hidden p-4 pb-0">
                                    {% if announcement.photo %}
                                        <img src="{{ announcement.photo.url }}" class="img-fluid w-100" alt="{{ announcement.title }}">
                                    {% else %}
                                        <img src="{% static 'img/test.jpg' %}" class="img-fluid w-100" alt="{{ announcement.title }}">
                                    {% endif %}
                                </div>
                                <div class="p-4">
                                    <div class="sermon-meta d-flex justify-content-between pb-2">
                                        <div>
                                            <small>
                                                <i class="fa fa-calendar me-2 text-muted"></i>
                                                {{ announcement.created_at|date:"d M Y" }}
                                            </small>
                                            <br>
                                            <small>
                                                <i class="fas fa-user me-2 text-muted"></i>
                                                {{ announcement.beneficiary|truncatechars:15 }}
                                            </small>
                                            <br>
                                            <small>
                                                <i class="fa fa-eye me-2 text-muted"></i>
                                                {{ announcement.views }} vues
                                            </small>
                                            <br>
                                            <small>
                                                {% if announcement.target_amount_achieved %}
                                                    <span class="text-success">atteint</span>
                                                {% else %}
                                                    <span class="text-danger">non atteint</span>
                                                {% endif %}
                                            </small>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-primary text-white mb-1">Objectif : {{ announcement.target_amount }}&nbsp;DT</span><br>
                                            <span class="badge bg-light text-dark mb-1">{{ announcement.get_category_display }}</span><br>
                                            {% if announcement.emergency %}
                                                <span class="badge bg-danger">Urgent</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <a href="{% url 'announcements:Details_Announcement' announcement.id %}" class="d-inline-block h4 lh-sm mb-3">{{ announcement.title|truncatechars:20 }}</a>
                                    <p class="mb-0">{{ announcement.description|truncatechars:100 }}</p>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center">
                            <p class="text-muted mb-0">Aucune annonce pour le moment.</p>
                        </div>
                        {% endfor %}                      
                    {% else %}
                        {% for announcement in announcements %}
                        <div class="col-lg-6 col-xl-4">
                            <div class="sermon-item wow fadeIn" data-wow-delay="0.{{ forloop.counter }}s">
                                <div class="overflow-hidden p-4 pb-0">
                                    {% if announcement.photo %}
                                        <img src="{{ announcement.photo.url }}" class="img-fluid w-100" alt="{{ announcement.title }}">
                                    {% else %}
                                        <img src="{% static 'img/test.jpg' %}" class="img-fluid w-100" alt="{{ announcement.title }}">
                                    {% endif %}
                                </div>
                                <div class="p-4">
                                    <div class="sermon-meta d-flex justify-content-between pb-2">
                                        <div>
                                            <small>
                                                <i class="fa fa-calendar me-2 text-muted"></i>
                                                {{ announcement.created_at|date:"d M Y" }}
                                            </small>
                                            <br>
                                            <small>
                                                <i class="fas fa-user me-2 text-muted"></i>
                                                {{ announcement.beneficiary|truncatechars:15 }}
                                            </small>
                                            <br>
                                            <small>
                                                <i class="fa fa-eye me-2 text-muted"></i>
                                                {{ announcement.views }} vues
                                            </small>
                                            <br>
                                            <small>
                                                {% if announcement.target_amount_achieved %}
                                                    <span class="text-success">atteint</span>
                                                {% else %}
                                                    <span class="text-danger">non atteint</span>
                                                {% endif %}
                                            </small>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-primary text-white mb-1">Objectif : {{ announcement.target_amount }}&nbsp;DT</span><br>
                                            <span class="badge bg-light text-dark mb-1">{{ announcement.get_category_display }}</span><br>
                                            {% if announcement.emergency %}
                                                <span class="badge bg-danger">Urgent</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <a href="{% url 'announcements:Details_Announcement' announcement.id %}" class="d-inline-block h4 lh-sm mb-3">{{ announcement.title|truncatechars:20 }}</a>
                                    <p class="mb-0">{{ announcement.description|truncatechars:100 }}</p>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center">
                            <p class="text-muted mb-0">Aucune annonce pour le moment.</p>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- Sermon End -->

        {% endblock content %}
    
            